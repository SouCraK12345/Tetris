<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表示</title>
    <style>
        canvas {
        height: 80%;
        position: absolute;
        top: 10%;
        left: 50%;
        /* ここを追加 */
        transform: translateX(-50%);
        /* ここを追加 */
        }
    </style>
</head>

<body>
    <input type="range" value="0" min="0" style="width: 100%" class="user">
    <canvas id="tetris"></canvas>
    <script type="module" src="connection.js"></script>
    <script>
        function draw_mino(x, y, mino_type, mino_position, size, ghost) {
            let lu_x = ((mino_position % 12 - 1) * 0.9 + 11.5);
            let lu_y = ((20 - Math.floor(mino_position / 12)) * 0.9 + 3);
            let color;
            if (ghost === 0) {
                color = mino_color[mino_type - 2];
            } else {
                color = ghost_mino_color[mino_type - 2];
            }
            ctx.fillStyle = color;
            ctx.fillRect(
                lu_x * size + x,
                lu_y * size + y,
                0.9 * size,
                0.9 * size
            );
        }
        function draw() {
            var ok = false;
            try {
                cloudData;
                ok = true;
            } catch (e) {
            }
            if (!ok) {
                requestAnimationFrame(draw);
                return false;
            }
            document.querySelector(".user").max = Object.keys(cloudData).length - 1;
            map = cloudData[Object.keys(cloudData)[document.querySelector(".user").value]].message;
            ctx.save();
            ctx.translate(-200 + shaking_x, 0 + shaking_y);
            shaking_x *= -0.5;
            shaking_y *= -0.5;
            // if (tet_type !== "") {
            //     mino_set();
            //     ghost_mino_set();
            // }
            // 画面クリアと背景描画
            ctx.clearRect(0, 0, 26 * size, 24 * size);
            // ctx.fillStyle = "#0e101f";
            // ctx.fillRect(0, 0, 26 * size, 24 * size);
            ctx.fillStyle = "#4d4d4d";
            ctx.fillRect(11.4 * size, 2.9 * size, 9.2 * size, 18.2 * size);
            ctx.fillRect(20.6 * size, 2.9 * size, 3.5 * size, 13.2 * size);
            ctx.fillRect(8 * size, 2.9 * size, 3.4 * size, 3.1 * size);
            ctx.fillStyle = "#222222";
            ctx.fillRect(11.5 * size, 3 * size, 9 * size, 18 * size);
            ctx.fillRect(20.6 * size, 3 * size, 3.4 * size, 13 * size);
            ctx.fillRect(8.1 * size, 3 * size, 3.3 * size, 2.9 * size);

            // 盤面上のミノ描画
            let v1 = 10;
            for (let row = 0; row < 25; row++) {
                v1 += 2;
                for (let col = 0; col < 10; col++) {
                    v1 += 1;
                    if (map[v1] > 0) {
                        draw_mino(0, 0, map[v1], v1, size, 0);
                    }
                }
            }

            // if (tet_type !== "") {
            //     // ゴーストミノ描画
            //     for (let i = 0; i < 4; i++) {
            //         draw_mino(0, 0, tet_type, ghost_fall_mino[i], size, 1);
            //     }
            //     // 落下中ミノ描画
            //     for (let i = 0; i < 4; i++) {
            //         draw_mino(0, 0, tet_type, fall_mino[i], size, 0);
            //     }
            // }

            // ホールドミノ描画
            // if (hold !== "") {
            //     for (let i = 0; i < 4; i++) {
            //         draw_mino(-60, -305, hold, mino_position[i + (hold - 2) * 16] + 6, size * 0.7, 0);
            //     }
            // }

            // ネクストミノ描画
            // for (let i = 0; i < 5; i++) {
            //     for (let j = 0; j < 4; j++) {
            //         draw_mino(315, -305 + 65 * i, next[i], mino_position[j + (next[i] - 2) * 16] + 6, size * 0.7, 0);
            //     }
            // }
            ctx.restore()
            requestAnimationFrame(draw);
        }
        let map;
        let size = 30;
        let canvas = document.getElementById("tetris");
        canvas.width = 18 * size;
        canvas.height = 24 * size;
        let ctx = canvas.getContext("2d");
        ctx.scale(1, 1);
        let shaking_x = 0;
        let shaking_y = 0;
        let mino_color = ["#00ffff", "#ffe600", "#33ff00", "#ff0000", "#0012ff", "#ff9100", "#ad00ff"];
        let ghost_mino_color = ["#007979ff", "#807300ff", "#197e00ff", "#740000ff", "#031297ff", "#703800ff", "#62008fff"];

        draw()
    </script>
</body>

</html>