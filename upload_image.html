<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Cloudinaryアップロード</title>
</head>
<body>
  <h2>画像をアップロード</h2>
  <input type="file" id="fileInput" />
  <p id="status"></p>
  <img id="preview" style="max-width: 300px; display: none;" />
  <script type="module" src="connection.js"></script>
  <script>
    const CLOUD_NAME = "djab7mm2z";
    const UPLOAD_PRESET = "OnlineTetris";
    window.user_name = localStorage.getItem("user_name");
    document.getElementById("fileInput").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", UPLOAD_PRESET);

      document.getElementById("status").textContent = "アップロード中…";

      const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
        method: "POST",
        body: formData
      });

      const data = await response.json();
      console.log("アップロード結果:", data);

      if (data.secure_url) {
        document.getElementById("status").textContent = "アップロード完了 ✅";
        const img = document.getElementById("preview");
        img.src = data.secure_url;
        img.style.display = "block";
        RatingSystem.setItem("image", data.secure_url);
      } else {
        document.getElementById("status").textContent = "アップロード失敗 ❌";
      }
    });
  </script>
</body>
</html>
