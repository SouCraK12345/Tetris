<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Tetris</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Stick&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bowlby+One&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="player-stats.css">
  <style>
    dialog.challange-result {
      position: relative;
      padding: 2.2rem 1.2rem;
    }

    dialog.challange-result .dialog-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: 0;
      color: inherit;
      font-size: 0.9rem;
      cursor: pointer;
      padding: 6px 8px;
    }
  </style>
</head>

<body>

  <div class="fixed-background-in-div"></div>
  <div class="match-start-dialog">
    バトルを開始します!
  </div>

  <div class="match-user-card-container">
    <div class="match-user-card" id="MatchUserCardLeft">ユーザー1</div>
    <div class="match-user-card" id="MatchUserCardRight">ユーザー2</div>
  </div>

  <div class="vsBoom-stage" id="vsBoom-stage">
    <div class="vsBoom-text" id="vsBoom-text">VS</div>
    <div class="vsBoom-sparks
  " aria-hidden="true">
      <span style="--vsdx:-120px; --vsdy:-40px;"></span>
      <span style="--vsdx:100px; --vsdy:-80px;"></span>
      <span style="--vsdx:-70px; --vsdy:120px;"></span>
      <span style="--vsdx:140px; --vsdy:40px;"></span>
      <span style="--vsdx:-140px; --vsdy:80px;"></span>
      <span style="--vsdx:60px; --vsdy:160px;"></span>
      <span style="--vsdx:-30px; --vsdy:200px;"></span>
      <span style="--vsdx:220px; --vsdy:-20px;"></span>
      <span style="--vsdx:-200px; --vsdy:-120px;"></span>
      <span style="--vsdx:0px; --vsdy:-160px;"></span>
    </div>
  </div>
  <div class="notification-banner" id="myNotificationBanner">
    <p class="message-text"><label class="request-from"></label><br>から対戦を申し込まれました!</p>
    <div class="progress-bar">
      <div class="progress-fill" style="width: 100%;"></div>
    </div>
  </div>
  <dialog class="accept_dialog">
    <label class="request-from"></label>と対戦しますか？
    <button onclick="accept(user_name,requested_name)">はい</button>
    <button onclick="close_accept()">いいえ</button>
  </dialog>
  <div class="header">
    <div class="header-title"><span class="header-title-span">Online Tetris</span>
      <a href="search/">
        <svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice" role="img" class="search">
          <circle cx="50" cy="56" r="28" stroke="white" stroke-width="10" fill="#00000000" />
          <line x1="68" y1="78" x2="90" y2="95" stroke="white" stroke-width="10" />
        </svg>
      </a>
    </div>
    <div class="match-making">
      マッチメイク中...
    </div>

    <label class="rank" style="font-size: min(3.5vw, 40px);"></label>
    <label class="point"></label>
    <label class="user-name-label"></label>
    <button class="login-button" onclick='document.querySelector(".login").showModal()'>Login</button>
  </div>
  <div hidden>
    <audio src="sound/launch.mp3" class="launch"></audio>
    <audio src="sound/hard-drop.mp3" class="hard-drop"></audio>
    <audio src="sound/t-spin.mp3" class="t-spin"></audio>
    <audio src="sound/tetris.mp3" class="tetris"></audio>
    <audio src="sound/btb.mp3" class="btb"></audio>
    <audio src="sound/move.mp3" class="move"></audio>
    <audio src="sound/line-delete.mp3" class="line-delete"></audio>
    <audio src="sound/show-card.mp3" class="show-card"></audio>
    <audio src="sound/battle-start.wav" class="battle-start"></audio>
    <audio src="sound/damage.mp3" class="damage"></audio>
    <audio src="sound/t-notice.mp3" class="t-notice"></audio>
    <audio src="virtualbattle-clear.wav" class="virtualbattle-clear"></audio>
    <!-- <audio src="bgm-ultra.mp3" class="bgm-ultra"></audio>
    <audio src="bgm-battle.mp3" class="bgm-battle"></audio>
    <audio src="bgm-40line.mp3" class="bgm-40line" loop></audio>
    <audio src="bgm-virtualbattle.mp3" class="bgm-virtualbattle" loop></audio> -->
  </div>
  <label id="attack_type"></label>
  <div class="details">
    <label class="left-label APM" style="bottom: 30%;">APM: 0.0</label>
    <label class="left-label PPS" style="bottom: calc(30% - 20px);">PPS: 0.0</label>
    <label class="left-label LINES" style="bottom: calc(30% - 40px);">Lines: 0</label>
    <label class="left-label REN" style="bottom: calc(30% - 60px);">REN: 0</label>
    <label class="left-label SCORE" style="bottom: calc(30% - 80px);">Score: 0</label>
    <label class="left-label TIME" style="bottom: calc(30% - 100px);">Time: 0</label>
  </div>
  <div id="chart-container">
    <canvas id="myLineChart"></canvas>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
  <script src="chart-js.js"></script>
  <canvas id="tetris">お使いのブラウザではhtmlのcanvasが対応していません。</canvas>
  <!-- タイマー表示ラベル -->
  <div id="timer-label">00:00</div>
  <div class="tile-card-container">
    <h3 class="title">Menu</h3>
    <button class="tile-card glass Ultra">
      <div class="tile-content">
        <h3>Ultra</h3>
      </div>
    </button>
    <button class="tile-card glass Forty-Line">
      <div class="tile-content">
        <h3>40 Line</h3>
      </div>
    </button>

    <button class="tile-card glass Marathon">
      <div class="tile-content">
        <h3>Marathon</h3>
      </div>
    </button>

    <button class="tile-card glass VirtualBattle">
      <div class="tile-content">
        <h3>VirtualBattle</h3>
      </div>
    </button>

    <button class="tile-card glass Watch" disabled="true">
      <div class="tile-content">
        <h3>Watch</h3>
      </div>
    </button>

    <button class="tile-card glass Discord">
      <div class="tile-content">
        <h3>Discord</h3>
      </div>
    </button>

    <button class="tile-card glass Setting">
      <div class="tile-content">
        <h3>Setting</h3>
      </div>
    </button>
  </div>
  <div class="wipe-in-box-container">
    <div class="wipe-in-box">
      Finish!
    </div>
  </div>
  <div class="result">
    <div style="grid-column: 1;">
      <video id="preview" controls width="640" loop></video>
    </div>
    <div style="grid-column: 2;">
      <h3 class="title">Result</h3>
      <table style="margin:0 auto;font-size: 1.2em;" cellpadding="5">
        <tr>
          <th>APM</th>
          <td class="result-apm">0</td>
        </tr>
        <tr>
          <th>Attack</th>
          <td class="result-attack">0</td>
        </tr>
        <tr>
          <th>PPS</th>
          <td class="result-pps">0</td>
        </tr>
        <tr>
          <th>Lines</th>
          <td class="result-lines">0</td>
        </tr>
        <tr>
          <th>Score</th>
          <td class="result-score">0</td>
        </tr>
        <tr>
          <th>Time</th>
          <td class="result-time">0</td>
        </tr>
      </table>
      <a class="save_replay" target="_blank">リプレイを保存</a>
      <button style="width: 100px; display: block; margin:0 auto;"
        onclick="battle_started = false;solo= true;back_to_menu();">もどる</button>
      <button style="width: 100px; display: block; margin:0 auto; display: none;"
        onclick="beforeSendRequest2();back_to_menu();" class="reBattle">再戦</button>
    </div>
  </div>
  <input type="range" value="0" min="0" style="width: 100%; display: none" class="user">
  <button class="long-button request" onclick="beforeSendRequest()">対戦する!</button>
  <dialog class="setting-dialog">
    <h2 style="width: 100%; text-align: center; column-span: all;">設定</h2>
    <div style="width: 100%; text-align: center; border-top: 1px solid;">ギアパワー</div>
    <div class="gear-container">

      <div class="gear-row">
        <button class="gear" data-index="1">1</button>
        <select></select>
      </div>

      <div class="gear-row">
        <button class="gear" data-index="2">2</button>
        <select></select>
      </div>

      <div class="gear-row">
        <button class="gear" data-index="3">3</button>
        <select></select>
      </div>

    </div>
    <div style="break-inside: avoid;">
      <div style="width: 100%; text-align: center; border-top: 1px solid;">ハンドリング</div>
      <div class="slider-container center">
        <input type="range" min="1" max="10" value="10" class="slider" id="arr" />
        <p class="slider-value">ARR: <span id="arr-label">0</span></p>
      </div>

      <div class="slider-container center">
        <input type="range" min="0" max="20" value="6" class="slider" id="das" />
        <p class="slider-value">DAS: <span id="das-label">6</span></p>
      </div>

      <div class="slider-container center">
        <input type="range" min="1" max="20" value="20" class="slider" id="sdf" />
        <p class="slider-value">SDF: <span id="sdf-label">75</span></p>
      </div>
      <div class="toggle_button">
        リトライ
        <input id="toggle" class="toggle_input retry" type='checkbox' checked />
        <label for="toggle" class="toggle_label"></label>
      </div>
    </div>
    <div style="width: 100%; text-align: center; border-top: 1px solid;">Virtual Battle</div>

    <div class="slider-container center">
      <input type="range" min="20" max="200" value="40" class="slider" id="virtualbattle-apm" />
      <p class="slider-value">APM: <span id="virtualbattle-apm-label">75</span></p>
    </div>


    <div style="width: 100%; text-align: center; border-top: 1px solid;">BGM</div>
    <!-- <button style="width: 100%; margin-bottom: 10px;" class="bgm-button" onclick="bgm_change()"></button> -->
    <input type="file" id="folderInput" webkitdirectory multiple>
    <div id="audioList"></div>
    <div id="music-list-container">
      <ul id="music-list">
      </ul>
      <div class="toggle_button">
        バトル終了時に曲を停止
        <input id="toggle" class="toggle_input stop-music" type='checkbox' checked />
        <label for="toggle" class="toggle_label"></label>
      </div>
    </div>
    <hr>
    <div style="width: 100%; text-align: center; border-top: 1px solid;">アカウント設定</div>
    <button style="width: 100%; margin-bottom: 10px;"
      onclick='window.open("upload_image.html", "new_window", "width=500,height=300,scrollbars=yes")'>画像をアップロード</button>
    <button style="width: 100%; margin-bottom: 10px;" onclick='regist_mail()'>メールアドレスを登録 (DMの通知)</button>
    <button
      style="position: absolute; top: 27px; right: 8px; width: auto; min-width: 60px; padding: 6px 12px; background: transparent; border: none; font-size: 1em; cursor: pointer;font-size: 40px;font-weight: bold;"
      onclick="document.querySelector('.setting-dialog').close()">×</button>
  </dialog>
  <dialog class="login">
    <h1 class="title" style="color: white;">Login</h1>
    <p>ユーザー名: <input class="username" type="email" style="width:fit-content" autocorrect="on"></p>
    <p>パスワード: <input class="password" type="password" style="width:fit-content" autocorrect="on"
        autocomplete="current-password"></p>
    <button style="width: 100%" onclick="login()" class="login-submit">ログイン</button>
    <a href="regist.html"
      style="width: 100%; text-align: center; display: block; color: white; margin: 20px 0;">ユーザー登録</a>
  </dialog>
  <dialog class="challange-result">
    <table style="width: 100%;">
      <td style="color: #ffd900; font-weight: bold;">WIN</td>
      <td class="win-count"></td>
      <td style="color: #2f00ff; font-weight: bold;">LOSE</td>
      <td class="lose-count"></td>
    </table>
    TOTAL: <label style="font-size: 50px" class="point">342pt</label>
    <button class="dialog-close" onclick="document.querySelector('.challange-result').close()">閉じる</button>
  </dialog>


  <div id="psb-body">
  </div>

  <div class="challange-container">
  </div>

  <canvas id="confettiCanvas"></canvas>
  <div class="center-text">昇格おめでとう!<br><span>S</span><br><label style="
    font-size: 0.5em;
">クリックで戻る</label></div>
  <div class="rank-up-container">
    <audio src="sound/rank-up.m4a" hidden class="rank-up-sound"></audio>
    <table class="rank-up-table">
      <td style="color: #ffd900; font-weight: bold;">WIN</td>
      <td class="win-count"></td>
      <td style="color: #2f00ff; font-weight: bold;">LOSE</td>
      <td class="lose-count"></td>
    </table>
    <div class="rank-up-total-point"></div>
    <div class="rank-up-point"></div>
  </div>

  <div id="music-title"></div>

  <div class="log" style="position:fixed; font-family: System;"></div>

  <div class="footer"><a href="https://forms.gle/yGQgU2kdECuRdUBPA">サイトの改善にご協力ください [報告]</a></div>

  <iframe id="floating-iframe" src="" style="display: none;"></iframe>

  <canvas class="battle-start" width="1000" height="1000"></canvas>
  <p class="battle-start">GO!</p>
  <p class="ready">Ready?</p>

  <dialog class="title-cover">
    <div class="title-text">Online Tetris</div>
    <div class="title-username">ログイン中: <span class="title-username"></span></div>
    <div style="display: flex;"><input class="title-password" type="password" placeholder="パスワードを入力...">
      <button onclick="title_login()" class="title-submit">ログイン</button>
    </div>
    <a href="javascript: logout()" style="color: white;">ログインせずに続ける</a>
  </dialog>
  <script src="tetris.js"></script>
  <script src="setting.js"></script>
  <script src="login.js"></script>
  <script src="request.js"></script>
  <script src="connection.js" type="module"></script>
  <script src="log.js"></script>
  <script src="rank-up.js"></script>
  <script src="direct-message.js"></script>
  <script src="record.js"></script>
</body>

</html>